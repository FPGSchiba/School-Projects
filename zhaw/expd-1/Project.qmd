---
title: "Projektarbeit - Bevölkerung Kanton Zürich"
author: "Blum, Nele und Erhardt, Jann"
format:
  pdf:
    include-in-header: 
      text: |
        \usepackage{scrlayer-scrpage}
        \rohead{Blum, Nele und Erhardt, Jann}
        \lofoot{Explorative Datenanalyse 1
        
        ZHAW School of Engineering}
editor: visual
toc: true
---

# Einleitung

TBD: eine generelle Einleitung.

In dieser Projektarbeit wird eine Analyse auf den Bevölkerungsstand der Stadt Zürich von den Jahren 1993 bis 2022 gemacht.

Gefunden?

Vorausnehmen?

## Datensatz

Link auf den Datensatz und kurze Erklärung.

Der [Datensatz](https://data.stadt-zuerich.ch/dataset/bev_bestand_jahr_quartier_alter_herkunft_geschlecht_od3903) wurde von der Offiziellen statistik Stelle der Stadt Zürich heruntergeladen und enthält, wie erwähnt Daten des Bevölkerungsstandes der Stadt Zürich. Diese Daten sind sehr Detailiert aufbereitet, da Alter, Herkunft, Geschlecht Kreis, Quartier und Jahr festgehalten werden.

```{r setup, echo = F}
knitr::opts_chunk$set(echo = F)
dat <- data <- read.csv('./data/BEV390OD3903.csv')
```

{{< pagebreak >}}

# Aufgabe 1

## Datentypen

```{r inspect}
library(knitr)
library(kableExtra)
library(magrittr)
data.frame(Variable = names(data),
           Datentyp = sapply(data, typeof),
           "Erste Werte" = sapply(data, function(x) paste0(head(x, 1),  collapse = ", ")),
           row.names = NULL) %>% 
  kable() %>%
    kable_styling(full_width = F, position='left', font_size = 10)
```

| Variablen Name      | Daten typ             |
|---------------------|-----------------------|
| **StichtagDatJahr** | Metrisch - Diskret    |
| **AlterVSort**      | Metrisch - Diskret    |
| **AlterVCd**        | Metrisch - Diskret    |
| **AlterVKurz**      | Metrisch - Diskret    |
| **AlterV05Sort**    | Kategoriell - Ordinal |
| **AlterV10Cd**      | Kategoriell - Ordinal |
| **AlterV10Kurz**    | Kategoriell - Ordinal |
| **AlterV20Cd**      | Kategoriell - Ordinal |
| **AlterV20Kurz**    | Kategoriell - Ordinal |
| **SexCd**           | Kategoriell - Nominal |
| **SexLang**         | Kategoriell - Nominal |
| **SexKurz**         | Kategoriell - Nominal |
| **KreisCd**         | Kategoriell - Nominal |
| **KreisLang**       | Kategoriell - Nominal |
| **QuarSort**        | Kategoriell - Nominal |
| **QuarCd**          | Kategoriell - Nominal |
| **QuarLang**        | Kategoriell - Nominal |
| **HerkunftSort**    | Kategoriell - Nominal |
| **HerkunftCd**      | Kategoriell - Nominal |
| **HerkunftLang**    | Kategoriell - Nominal |
| **AnzBestWir**      | Metrisch - Diskret    |

{{< pagebreak >}}

## Vorbereitung

TBD: Kurze vorbereitungsbeschreibung mit snippets

```{r aufgabe-1-vorb}
jug_filtered_data <- data[data$StichtagDatJahr == 2022 & data$AlterV20Kurz == "0-19",]
sen_filtered_data <- data[data$StichtagDatJahr == 2022 & data$AlterVKurz >= 65,]
ges_filtered_data <- data[data$StichtagDatJahr == 2022,]
jug <- c()
sen <- c()
ges <- c()
kreise <- c("Kreis 1", "Kreis 2", "Kreis 3", "Kreis 4", "Kreis 5", "Kreis 6", "Kreis 7", "Kreis 8", "Kreis 9", "Kreis 10", "Kreis 11", "Kreis 12")
for (kreis in kreise) {
  temp <- sum(jug_filtered_data[jug_filtered_data$KreisLang == kreis,]$AnzBestWir)
  jug <- c(jug, temp)
  temp <- sum(sen_filtered_data[sen_filtered_data$KreisLang == kreis,]$AnzBestWir)
  sen <- c(sen, temp)
  temp <- sum(ges_filtered_data[ges_filtered_data$KreisLang == kreis,]$AnzBestWir)
  ges <- c(ges, temp)
}
out_jug <- jug / ges
out_sen <- sen / ges
names(out_sen) <- kreise
names(out_jug) <- kreise
names(jug) <- kreise
names(sen) <- kreise
```

## Darstellung 1

```{r aufgabe-1-dar-1}
barplot(out_jug, las = 2, col = "green4", ylab = "Relative Häufigkeit", main = "Anzahl Minderjähriger in der Stadt Zürich pro Kreis in 2022")
```

TBD: Beschreibung und Notizen zur grafik

{{< pagebreak >}}

## Darstellung 2

```{r aufgabe-1-dar-2}
barplot(out_sen, las = 2, col = "green4", ylab = "Relative Häufigkeit", main = "Anzahl Senioren in der Stadt Zürich pro Kreis in 2022")
```

TBD: Beschreibung und Notizen zur beschreibung

## Kennzahlen

Das Arithmetische Mittel des Bevölkerungsbestandes an Jugendlichen im Jahre 2022 ist: **`r mean(jug)`**.

Der Median des Bevölkerungsstandes an Senioren im Jahre 2022 ist: **`r median(sen)`**.

Diese beiden Werte Sagen nicht viel über den Bestand allgemein aus, aber können trotzdem den Bestand an Senioren und Jugendlichen gut darstellen.

{{< pagebreak >}}

# Aufgabe 2

TBD: Aufgabenstellung

## Vorbereitung

TBD: Vorbereitungsbeschreibung

```{r aufgabe-2-vorb, echo=F}
year_2022 <- data[data$StichtagDatJahr == 2022,]

alters_gruppen <- c("0-19", "20-39", "40-59", "60-79", "80-99")

# Zu finden: Innerhalb der Gruppen der Bestand für 1 Alter
alters_data <- data.frame("start"=1:20)
for (gruppe in alters_gruppen) {
  for (alter in unique(year_2022[year_2022$AlterV20Kurz == gruppe,]$AlterVKurz)) {
    alters_data[alter, "summe"] <- sum(year_2022[year_2022$AlterVKurz == alter,]$AnzBestWir)
    alters_data[alter, "gruppe"] <- gruppe
    alters_data[alter, "alter"] <- alter
  }
}
alters_data <- subset(alters_data, select = -start)
```

## Darstellung 1

```{r aufgabe-2-dar-1}
#| layout-ncol: 2
#| fig-cap: 
#|  - "Boxplot"
#|  - "Line Plot"
#| fig-height: 6
boxplot(summe ~ gruppe, data = alters_data, main="20 Jahres Gruppen im Jahr 2022", xlab = "Altersgruppe", ylab="Anzahl Personen")
plot(x=alters_data$alter, y=alters_data$summe, type = "o", ylab="Anzahl", xlab="Alter", main="Anzahl Personen pro Alter im Jahr 2022")
```

TBD: Bild Beschreibung

### Variation

```{r aufgabe-2-dar-1v}
par(mfcol=c(1,1), mar=c(2.5,2.5,2,3), xpd =T)
boxplot(summe ~ gruppe, data = alters_data, main="20 Jahres Gruppen im Jahr 2022 mit Alter", xlab = "Altersgruppe", ylab="Anzahl Personen")
points_y <- c(rep(1, 20), rep(2, 20), rep(3, 20), rep(4, 20), rep(5, 19))
library(RColorBrewer)
qual_col_pals <- brewer.pal.info[brewer.pal.info$category == 'qual',]
col_vector_20 <- tail(unlist(mapply(brewer.pal, qual_col_pals$maxcolors, rownames(qual_col_pals))), 20)
col_vector <- head(rep(col_vector_20, 5), -1)
symb_vector <- 0:19
points(y=alters_data$summe, x=points_y, col = col_vector, pch=symb_vector)
legend(x=5.8, y=10000, col = col_vector_20, legend = 0:19, pch=symb_vector, cex=0.6)
```

TBD: Beschreibung & Erklärung

{{< pagebreak >}}

## Darstellung 2

TBD: Nele Code here ;)

```{r aufgabe-2-dar-2}
dat$Altersgruppen <- NULL
dat[dat$AlterV20Kurz == "0-19", "Altersgruppen"] <- "0-19"
dat[dat$AlterV20Kurz == "80-99","Altersgruppen"] <- "80-99"
dat[dat$AlterV20Kurz == "20-39","Altersgruppen"] <- "20-39"
dat[dat$AlterV20Kurz == "40-59","Altersgruppen"] <- "40-59"
dat[dat$AlterV20Kurz == "60-79","Altersgruppen"] <- "60-79"
dat[dat$AlterV20Kurz == "100 u. älter","Altersgruppen"] <- "100 u. älter"
kreise <- c("Kreis 1", "Kreis 2", "Kreis 3", "Kreis 4", "Kreis 5", "Kreis 6", "Kreis 7", "Kreis 8", "Kreis 9", "Kreis 10", "Kreis 11", "Kreis 12")
altersgruppen_table <- table(factor(dat$Altersgruppen, levels = c("0-19", "20-39", "40-59", "60-79", "80-99","100 u. älter"),labels = c("0-19", "20-39", "40-59", "60-79", "80-99","100+"), ordered = T), factor(dat$KreisLang, levels = kreise, ordered = T))
df_altersgruppen <- as.data.frame(altersgruppen_table)
par(mfcol=c(1,1), mar=c(4.5,4,0,7), xpd =T)
barplot(altersgruppen_table, las = 1, ylim = c(0,11000), col = c("turquoise", "yellow", "green", "red", "orange", "blue"), beside = T, las = 2)
legend(x=87, y=9000, col = c("turquoise", "yellow", "green", "red", "orange", "blue"), pch = 15, legend = unique(data$Altersgruppen))
```

# Aufgabe 4

## Darstellung 1

```{r aufgabe-4-dar-1}
#| layout-ncol: 1
#| fig-width: 8
#| fig-height: 4.5
library(ggplot2)
data$Altersgruppen <- NULL
data[data$AlterV20Kurz == "0-19", "Altersgruppen"] <- "0-19"
data[data$AlterV20Kurz == "80-99","Altersgruppen"] <- "80-99"
data[data$AlterV20Kurz == "20-39","Altersgruppen"] <- "20-39"
data[data$AlterV20Kurz == "40-59","Altersgruppen"] <- "40-59"
data[data$AlterV20Kurz == "60-79","Altersgruppen"] <- "60-79"
data[data$AlterV20Kurz == "100 u. älter","Altersgruppen"] <- "100 u. älter"

altersgruppen_table <- table(factor(data$Altersgruppen, levels = c("0-19", "20-39", "40-59", "60-79", "80-99","100 u. älter"), 
                                    labels = c("0-19", "20-39", "40-59", "60-79", "80-99","100+")),
                             factor(data$KreisLang, levels = c("Kreis 1", "Kreis 2", "Kreis 3", "Kreis 4", "Kreis 5", "Kreis 6", "Kreis 7", "Kreis 8", "Kreis 9", "Kreis 10", "Kreis 11", "Kreis 12"), ordered = T))
df_altersgruppen <- as.data.frame(altersgruppen_table)

ggplot(data= df_altersgruppen, aes(x = Var2, y = Freq, colour = Var1)) +
  geom_point(position = position_jitter(width = 0.15, height = 0), size = 4) +
  guides(color = guide_legend(order = 1)) +
  labs(title = "Bevölkerungsanzahl pro Kreis und Gruppe im Jahr 2000", x = "", y = "Anzahl Personen", colour = "Altersgruppen")
```
Beschreibung der Grafik kommt hier.


## Darstellung 2


```{r aufg-4-dar-2}
time_v <- unique(data$StichtagDatJahr)
groups <- unique(data$AlterV20Kurz)
group <- c()
time <- c()
value <- c()

for (year in time_v) {
  temp <- data[data$StichtagDatJahr == year,]
  for (g in groups) {
    value <- c(value, sum(temp[temp$AlterV20Kurz == g,]$AnzBestWir))
    group <- c(group, g)
    time <- c(time, year)
  }
}

group <- factor(group, levels = c("0-19", "20-39", "40-59", "60-79", "80-99", "100 u. älter"), ordered = T, labels = c("0-19", "20-39", "40-59", "60-79", "80-99","100+"))

groups_over_time <- data.frame(time=time, group=group, value=value)

ggplot(groups_over_time, aes(x=time, y=value, fill=group)) + 
  geom_area() + 
  labs(fill = "Altersgruppen", title = "Bevölkerungswachstum bis 2022", x = "Zeit (Jahre)", y = "Bevölkerungsanzhal")
```


Noch eine Beschreibung, zu guter letzt.